<?php

/**
 * @file
 */

function stormtimetracking_install() {
  switch ($GLOBALS['db_type']) {
    case 'mysql':
    case 'mysqli':
      db_query("
        CREATE TABLE {stormtimetracking} (
          vid INT(10) UNSIGNED NOT NULL DEFAULT '0',
          nid INT(10) UNSIGNED NOT NULL DEFAULT '0',
          organization_nid INT(10),
          organization_title VARCHAR(150),
          project_nid INT(10),
          project_title VARCHAR(128),
          task_nid INT(10),
          task_stepno VARCHAR(128),
          task_title VARCHAR(128),
          ticket_nid INT(10),
          trackingdate INT(10),
          timebegin VARCHAR(5),
          timeend VARCHAR(5),
          duration FLOAT,
          billable INT(1),
          PRIMARY KEY (vid, nid),
          KEY {stormtimetracking}_nid (nid)
        ) /*!40100 DEFAULT CHARACTER SET utf8 */;
    ");
    break;
    case 'pgsql':
      db_query("CREATE TABLE {stormtimetracking} (
          vid INT NOT NULL DEFAULT '0',
          nid INT NOT NULL DEFAULT '0',
          organization_nid INT,
          organization_title VARCHAR(150),
          project_nid INT,
          project_title VARCHAR(128),
          task_nid INT,
          task_stepno VARCHAR(128),
          task_title VARCHAR(128),
          ticket_nid INT,
          trackingdate INT,
          timebegin VARCHAR(5),
          timeend VARCHAR(5),
          duration FLOAT,
          billable INT,
          PRIMARY KEY (vid, nid)
      );");
      db_query("CREATE INDEX {stormtimetracking}_nid_idx ON {stormtimetracking} (nid)");
    break;
  }
}

function stormtimetracking_uninstall() {
  db_query("DROP TABLE IF EXISTS {stormtimetracking}");
}

function stormtimetracking_update_1() {
  $items = array();
  switch ($GLOBALS['db_type']) {
  case 'mysql':
  case 'mysqli':
    $items[] = update_sql("ALTER TABLE {stormtimetracking} ADD COLUMN ticket_nid INT(10)");
    $items[] = update_sql("ALTER TABLE {stormtimetracking} ADD COLUMN ticket_title VARCHAR(128)");
  break;
  case 'pgsql':
    $items[] = update_sql("ALTER TABLE {stormtimetracking} ADD COLUMN ticket_nid INT");
    $items[] = update_sql("ALTER TABLE {stormtimetracking} ADD COLUMN ticket_title VARCHAR(128)");
  break;
  }
  return $items;
}

function stormtimetracking_update_2() {
  $items = array();
  switch ($GLOBALS['db_type']) {
  case 'mysql':
  case 'mysqli':
    $items[] = update_sql("ALTER TABLE {stormtimetracking} ADD COLUMN billable INT(1)");
  break;
  case 'pgsql':
    $items[] = update_sql("ALTER TABLE {stormtimetracking} ADD COLUMN billable INT");
  break;
  }
  return $items;
}
